<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Read Yaroster's latest writing without leaving the site.">
    <title>Blog</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/_astro/index.Bwr9uro6.css">
    <script type="module" src="/_astro/hoisted.6zktFTKN.js" defer></script>
    <style>
        :root {
            color-scheme: dark;
            --hub-ease: cubic-bezier(0.4, 0, 0.2, 1);
            --page-bg: radial-gradient(circle at 25% 15%, rgba(92, 92, 105, 0.12) 0, transparent 55%),
                        radial-gradient(circle at 70% 20%, rgba(92, 92, 122, 0.08) 0, transparent 58%),
                        #050507;
            --panel-bg: rgba(14, 14, 24, 0.78);
            --panel-border: rgba(148, 163, 184, 0.18);
            --text-primary: rgba(245, 245, 250, 0.94);
            --text-muted: rgba(235, 235, 245, 0.65);
            --card-radius: 28px;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: var(--page-bg);
            color: var(--text-primary);
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        .blog-wrapper {
            position: relative;
        }

        .blog-wrapper > .mx-auto {
            padding-top: clamp(2.5rem, 6vh, 4rem);
            padding-bottom: clamp(2.5rem, 6vh, 4rem);
        }

        .blog-meta {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-top: -1rem;
            margin-bottom: clamp(1.5rem, 3vh, 2.5rem);
        }

        .blog-meta a {
            text-decoration: none;
            color: var(--text-muted);
            transition: color 200ms var(--hub-ease);
            letter-spacing: 0.35em;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .blog-meta a:hover,
        .blog-meta a:focus-visible {
            color: var(--text-primary);
        }

        .lede {
            margin-bottom: clamp(2rem, 4vh, 3rem);
        }

        .lede p {
            color: var(--text-muted);
        }

        .blog-grid {
            display: grid;
            gap: clamp(1.5rem, 3vw, 2.5rem);
            grid-template-columns: repeat(2, 1fr);
            margin-bottom: clamp(2rem, 4vh, 3rem);
            transition: transform 520ms var(--hub-ease), opacity 520ms var(--hub-ease);
        }

        /* Handle odd number of items - last item spans 2 columns if it's alone */
        .blog-grid:not([data-clamped="true"]) .blog-card:last-child:nth-child(odd) {
            grid-column: 1 / -1;
        }

        @media (min-width: 768px) {
            .blog-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .blog-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            /* For 3-column grid, if last item is alone, span 2 columns and center */
            .blog-grid:not([data-clamped="true"]) .blog-card:last-child:nth-child(3n+1) {
                grid-column: 2 / 4;
            }
        }

        @media (min-width: 1440px) {
            .blog-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            /* For 4-column grid, handle last item scenarios */
            .blog-grid:not([data-clamped="true"]) .blog-card:last-child:nth-child(4n+1) {
                grid-column: 2 / 4;
            }
            .blog-grid:not([data-clamped="true"]) .blog-card:last-child:nth-child(4n+3) {
                grid-column: 3 / 5;
            }
        }

        
        @media (min-width: 1830px) {
            .blog-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        .blog-grid__status {
            grid-column: 1 / -1;
            text-align: center;
            color: var(--text-muted);
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .blog-card {
            position: relative;
            display: flex;
            flex-direction: column;
            border-radius: var(--card-radius);
            overflow: hidden;
            border: 1px solid var(--panel-border);
            background: rgba(16, 16, 26, 0.78);
            box-shadow: 0 28px 80px rgba(10, 10, 18, 0.45);
            text-decoration: none;
            color: inherit;
            transition: transform 240ms var(--hub-ease), border-color 240ms var(--hub-ease), box-shadow 240ms var(--hub-ease);
        }

        .blog-card.is-clamped-hidden {
            display: none !important;
        }

        .blog-card:hover,
        .blog-card:focus-visible {
            transform: translateY(-6px);
            border-color: rgba(255, 255, 255, 0.22);
            box-shadow: 0 36px 120px rgba(12, 12, 22, 0.55);
        }

        .blog-card:focus-visible {
            outline: none;
        }

        .blog-card__media {
            width: 100%;
            aspect-ratio: 21 / 9;
            background: linear-gradient(135deg, rgba(46, 46, 64, 0.6), rgba(20, 20, 34, 0.9));
            background-size: cover;
            background-position: center;
        }

        .blog-card__body {
            padding: 1.8rem clamp(1.5rem, 3vw, 2rem) 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .blog-card__title {
            font-size: 1.15rem;
            letter-spacing: 0.05em;
            line-height: 1.3;
        }

        @media (min-width: 768px) {
            .blog-card__title {
                font-size: clamp(0.75rem, 2.5vw, 1.15rem);
                max-height: calc(1.3em * 2);
                overflow: hidden;
            }
        }

        .blog-card__meta {
            font-size: 0.8rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .blog-card__excerpt {
            font-size: 0.92rem;
            line-height: 1.6;
            color: var(--text-muted);
        }

        .blog-open {
            margin: 0 auto clamp(2rem, 5vh, 3.5rem);
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0.75rem 1.6rem;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(15, 15, 26, 0.72);
            color: rgba(235, 235, 245, 0.82);
            text-transform: uppercase;
            letter-spacing: 0.18em;
            font-size: 0.78rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 200ms var(--hub-ease), border-color 200ms var(--hub-ease), background-color 200ms var(--hub-ease);
        }

        .blog-open svg {
            width: 14px;
            height: 14px;
        }

        .blog-open:hover,
        .blog-open:focus-visible {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.35);
            background: rgba(19, 19, 32, 0.88);
        }

        .blog-open:focus-visible {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.22);
        }

        .blog-lang {
            display: flex;
            gap: 0.5rem;
        }

        .blog-lang__button {
            appearance: none;
            border: 1px solid rgba(120, 134, 163, 0.28);
            background: rgba(18, 18, 26, 0.42);
            color: rgba(235, 235, 245, 0.7);
            letter-spacing: 0.16em;
            text-transform: uppercase;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.45rem 0.95rem;
            border-radius: 999px;
            cursor: pointer;
            transition: transform 150ms var(--hub-ease), border-color 150ms var(--hub-ease), background-color 150ms var(--hub-ease);
        }

        .blog-lang__button:hover,
        .blog-lang__button:focus-visible {
            transform: translateY(-1px);
            border-color: rgba(255, 255, 255, 0.45);
            background: rgba(24, 24, 36, 0.7);
        }

        .blog-lang__button:focus-visible {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.18);
        }

        .blog-lang__button[data-active="true"] {
            border-color: rgba(255, 255, 255, 0.55);
            background: rgba(32, 32, 48, 0.85);
            color: rgba(245, 245, 250, 0.92);
        }

        @media (max-width: 424px) {
            .blog-meta {
                flex-direction: column;
                align-items: flex-start;
                justify-content: flex-start;
                gap: 0.75rem;
            }

            .blog-lang {
                flex-wrap: wrap;
                justify-content: flex-start;
            }
        }

        @media (max-width: 640px) {
            .blog-grid {
                grid-template-columns: 1fr !important;
            }
        }

        .c-cursor {
            position: fixed !important;
            z-index: 2147483647 !important;
            pointer-events: none !important;
        }
    </style>
</head>
<body class="bg-black leading-relaxed text-neutral-200 tracking-wide antialiased selection:bg-neutral-300 selection:text-neutral-900 z-10 relative">
<style>astro-island,astro-slot,astro-static-slot{display:contents}</style>


<div class="blog-wrapper">
    <div class="mx-auto max-w-screen-xl px-6 py-16 font-sans md:px-12 lg:px-24">
        <div class="blog-meta">
            <a href="hub.html" data-i18n="back-link">‚Üê Back</a>
            <div class="blog-lang" role="group" aria-label="Language" dir="ltr">
                <button type="button" class="blog-lang__button" data-blog-lang="en">EN</button>
                <button type="button" class="blog-lang__button" data-blog-lang="fr">FR</button>
                <button type="button" class="blog-lang__button" data-blog-lang="ar">AR</button>
                <button type="button" class="blog-lang__button" data-blog-lang="zh">ZH</button>
            </div>
        </div>
        <div class="lede space-y-4">
            <p class="text-sm uppercase tracking-[0.4em] text-neutral-400" data-i18n="blog-subtitle">Latest essays</p>
            <h1 class="text-4xl md:text-5xl font-bold text-neutral-100" data-hub-target data-i18n="blog-title">Blog</h1>
            <p class="max-w-2xl text-sm md:text-base" data-i18n="blog-description">Curated highlights from skoomaDen. Explore the latest essays, each with its cover art and a short abstract.</p>
        </div>
        <p class="blog-grid__status" data-blog-status hidden></p>
        <div class="blog-grid" data-hub-fade data-blog-list></div>
        <button type="button" class="blog-open" data-blog-open>
            <span data-i18n="more-skoomaDen">More on skoomaDen</span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M7 17L17 7" />
                <path d="M10 7h7v7" />
            </svg>
        </button>
    </div>
</div>
<script>
(() => {
    const resolveContentLanguage = (code) => (code === 'fr' ? 'fr' : 'en');
    const normaliseLanguage = (value) => (value || 'en').toLowerCase();

    const detectLanguage = () => {
        const stored = sessionStorage.getItem('blogLanguage');
        if (stored) return stored;
        const preferred = (navigator.languages || [navigator.language || 'en']).map((lang) => (lang || '').toLowerCase());
        if (preferred.some((lang) => lang.startsWith('fr'))) return 'fr';
        if (preferred.some((lang) => lang.startsWith('ar'))) return 'ar';
        if (preferred.some((lang) => lang.startsWith('zh') || lang.includes('han'))) return 'zh';
        return 'en';
    };

// Translation dictionary
const translations = {
    en: {
        'back-link': '‚Üê Back',
        'blog-subtitle': 'Latest essays',
        'blog-title': 'Blog',
        'blog-description': 'Curated highlights from skoomaDen. Explore my latest articles!',
        'more-skoomaDen': 'More on skoomaDen',
        'fetching': 'Fetching posts‚Ä¶',
        'error': 'Could not load the blog feed right now.'
    },
    fr: {
        'back-link': '‚Üê Retour',
        'blog-subtitle': 'Derniers articles',
        'blog-title': 'Blog',
        'blog-description': 'Une s√©lection soign√©e de skoomaDen. D√©couvrez mes articles r√©cents !',
        'more-skoomaDen': 'Plus sur skoomaDen',
        'fetching': 'Chargement des publications‚Ä¶',
        'error': 'Impossible de charger le flux du blog pour le moment.'
    },
    ar: {
        'back-link': '‚Üí ÿ±ÿ¨Ÿàÿπ',
        'blog-subtitle': 'ÿ£ÿ≠ÿØÿ´ ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™',
        'blog-title': 'ÿßŸÑŸÖÿØŸàŸÜÿ©',
        'blog-description': 'ŸÖÿÆÿ™ÿßÿ±ÿßÿ™ ŸÖŸÖŸäÿ≤ÿ© ŸÖŸÜ skoomaDen. ÿßÿ≥ÿ™ŸÉÿ¥ŸÅ ÿ£ÿ≠ÿØÿ´ ŸÖŸÇÿßŸÑÿßÿ™Ÿä!',
        'more-skoomaDen': 'ÿßŸÑŸÖÿ≤ŸäÿØ ÿπŸÑŸâ skoomaDen',
        'fetching': 'ÿ¨ÿßÿ±Ÿç ÿ¨ŸÑÿ® ÿßŸÑŸÖŸÜÿ¥Ÿàÿ±ÿßÿ™‚Ä¶',
        'error': 'ÿ™ÿπÿ∞Ÿëÿ± ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖÿØŸàŸÜÿ© ÿ≠ÿßŸÑŸäÿßŸã.'
    },
    zh: {
        'back-link': '‚Üê ËøîÂõû',
        'blog-subtitle': 'ÊúÄÊñ∞ÊñáÁ´†',
        'blog-title': 'ÂçöÂÆ¢',
        'blog-description': 'Êù•Ëá™ skoomaDen ÁöÑÁ≤æÈÄâÂÜÖÂÆπ„ÄÇÊé¢Á¥¢ÊàëÁöÑÊúÄÊñ∞ÊñáÁ´†ÔºÅ',
        'more-skoomaDen': 'Êõ¥Â§ö skoomaDen ÂÜÖÂÆπ',
        'fetching': 'Ê≠£Âú®Ëé∑ÂèñÊñáÁ´†‚Ä¶',
        'error': 'ÊöÇÊó∂Êó†Ê≥ïÂä†ËΩΩÂçöÂÆ¢ÂÜÖÂÆπ„ÄÇ'
    }
};


    const applyTranslations = (lang) => {
        const elements = document.querySelectorAll('[data-i18n]');
        elements.forEach((el) => {
            const key = el.getAttribute('data-i18n');
            if (translations[lang] && translations[lang][key]) {
                el.textContent = translations[lang][key];
            }
        });
        
        // Handle RTL for Arabic
        if (lang === 'ar') {
            document.documentElement.setAttribute('dir', 'rtl');
        } else {
            document.documentElement.setAttribute('dir', 'ltr');
        }
    };

    const handleHubTransition = () => {
        const stored = sessionStorage.getItem('hubTransition');
        if (!stored) return;
        let data;
        try {
            data = JSON.parse(stored);
        } catch {
            sessionStorage.removeItem('hubTransition');
            return;
        }
        if (!data?.target || !data.target.endsWith('blog.html')) return;
        sessionStorage.removeItem('hubTransition');
        const ease = 'cubic-bezier(0.4, 0, 0.2, 1)';
        const animate = (el, delay = 0) => {
            if (!el) return;
            el.style.transition = `opacity 420ms ${ease}`;
            el.style.opacity = '0';
            const cleanup = () => {
                el.style.removeProperty('opacity');
                el.style.removeProperty('transition');
            };
            const onEnd = (event) => {
                if (event.propertyName !== 'opacity') return;
                el.removeEventListener('transitionend', onEnd);
                cleanup();
            };
            el.addEventListener('transitionend', onEnd);
            setTimeout(() => {
                requestAnimationFrame(() => {
                    el.style.opacity = '1';
                });
            }, delay);
            setTimeout(() => {
                cleanup();
                el.removeEventListener('transitionend', onEnd);
            }, delay + 1200);
        };
        const heading = document.querySelector('[data-hub-target]');
        const fades = Array.from(document.querySelectorAll('[data-hub-fade]'));
        animate(heading);
        fades.forEach((node, idx) => animate(node, 80 * (idx + 1)));
    };

    handleHubTransition();

    const listRoot = document.querySelector('[data-blog-list]');
    const statusNode = document.querySelector('[data-blog-status]');
    const externalButtons = document.querySelectorAll('[data-blog-open]');
    const languageButtons = Array.from(document.querySelectorAll('[data-blog-lang]'));

    let lastRenderedItems = [];
    let lastRenderOptions = { message: '', fallback: false };
    let resizeDebounceId;

    let selectedLang = detectLanguage();
    sessionStorage.setItem('blogLanguage', selectedLang);

    if (statusNode) {
        statusNode.hidden = false;
        statusNode.textContent = translations[selectedLang]['fetching'] || 'Fetching posts‚Ä¶';
    }

    // Apply initial translations
    applyTranslations(selectedLang);

    // Update language button states
    const updateLanguageButtons = () => {
        languageButtons.forEach((button) => {
            button.setAttribute('data-active', button.dataset.blogLang === selectedLang ? 'true' : 'false');
        });
    };

    updateLanguageButtons();

    const clampGridToFirstRowIfOverflow = () => {
        if (!listRoot) return;
        const cards = Array.from(listRoot.querySelectorAll('.blog-card'));
        if (!cards.length) {
            listRoot.removeAttribute('data-clamped');
            return;
        }
        cards.forEach((card) => card.classList.remove('is-clamped-hidden'));
        listRoot.removeAttribute('data-clamped');

        const mediaQuery = window.matchMedia('(min-width: 1024px)');
        const isDesktop = typeof mediaQuery.matches === 'boolean' ? mediaQuery.matches : window.innerWidth >= 1024;
        if (!isDesktop) return;

        requestAnimationFrame(() => {
            const scrollHeight = Math.max(
                document.documentElement?.scrollHeight || 0,
                document.body?.scrollHeight || 0
            );
            if (scrollHeight <= window.innerHeight + 1) return;

            const firstRowTop = cards[0].offsetTop;
            let hiddenAny = false;
            for (let i = 1; i < cards.length; i += 1) {
                if (Math.abs(cards[i].offsetTop - firstRowTop) > 1) {
                    cards[i].classList.add('is-clamped-hidden');
                    hiddenAny = true;
                }
            }
            if (hiddenAny) {
                listRoot.setAttribute('data-clamped', 'true');
            }
        });
    };

    const renderPosts = (items, { message = '', fallback = false } = {}) => {
        if (!listRoot) return;
        lastRenderedItems = items.slice();
        lastRenderOptions = { message, fallback };
        listRoot.removeAttribute('data-clamped');
        listRoot.innerHTML = '';
        if (!items.length) {
            const empty = document.createElement('div');
            empty.className = 'blog-grid__status';
            empty.textContent = 'No posts found yet.';
            listRoot.append(empty);
        } else {
            const formatter = new Intl.DateTimeFormat(undefined, { month: 'short', day: 'numeric', year: 'numeric' });
            const fragment = document.createDocumentFragment();
            const fallbacks = [
                'linear-gradient(135deg, rgba(46,46,64,0.6), rgba(20,20,34,0.9))',
                'linear-gradient(135deg, rgba(58,48,78,0.7), rgba(26,22,42,0.92))',
                'linear-gradient(135deg, rgba(40,56,68,0.64), rgba(18,26,34,0.9))'
            ];
            items.forEach((item) => {
                const card = document.createElement('a');
                card.className = 'blog-card';
                card.href = item.link;
                card.target = '_blank';
                card.rel = 'noreferrer noopener';
                card.setAttribute('dir', 'ltr');

                const media = document.createElement('div');
                media.className = 'blog-card__media';
                if (item.cover) {
                    media.style.backgroundImage = `url(${item.cover})`;
                } else {
                    media.style.backgroundImage = fallbacks[Math.floor(Math.random() * fallbacks.length)];
                }

                const body = document.createElement('div');
                body.className = 'blog-card__body';

                const meta = document.createElement('span');
                meta.className = 'blog-card__meta';
                meta.textContent = formatter.format(new Date(item.pubDate));

                const title = document.createElement('h2');
                title.className = 'blog-card__title';
                title.textContent = item.title;

                const excerpt = document.createElement('p');
                excerpt.className = 'blog-card__excerpt';
                excerpt.textContent = item.description;

                body.append(meta, title, excerpt);
                card.append(media, body);
                fragment.append(card);
            });
            listRoot.append(fragment);
            clampGridToFirstRowIfOverflow();
        }

        if (statusNode) {
            if (message) {
                statusNode.hidden = false;
                statusNode.textContent = message;
            } else {
                statusNode.hidden = true;
                statusNode.textContent = '';
            }
        }
    };

    const extractItemsFromXml = (xml) => {
        const nodes = Array.from(xml.querySelectorAll('channel > item'));
        return nodes.map((node) => {
            // Try multiple selectors for each field to handle different RSS formats
            const getContent = (selectors) => {
                for (const selector of selectors) {
                    const element = node.querySelector(selector);
                    if (element?.textContent?.trim()) {
                        return element.textContent.trim();
                    }
                }
                return null;
            };

            // Special handling for cover images - check enclosure URL attribute
            let coverUrl = getContent(['cover', 'media\\:thumbnail', 'image']);
            if (!coverUrl) {
                const enclosure = node.querySelector('enclosure[type^="image"]');
                if (enclosure) {
                    coverUrl = enclosure.getAttribute('url');
                }
            }

            return {
                title: getContent(['title']) || 'Untitled',
                link: getContent(['link', 'guid[isPermaLink="true"]', 'guid']) || '#',
                description: getContent(['description', 'summary', 'content\\:encoded']) || '',
                pubDate: getContent(['pubDate', 'published', 'dc\\:date']) || new Date().toISOString(),
                cover: coverUrl || null,
                language: (getContent(['language', 'dc\\:language']) || 'en').toLowerCase()
            };
        });
    };

    const pickItemsForLanguage = (items) => {
        // For blog content, we try to match the selected UI language with article language
        // But we show articles in any language if the exact match isn't available
        const languageMatches = items.filter((item) => normaliseLanguage(item.language).startsWith(selectedLang));
        if (languageMatches.length >= 3) {
            return { items: languageMatches.slice(0, 6), fallback: false, message: '' };
        }
        // If not enough articles in selected language, show English articles
        const english = items.filter((item) => normaliseLanguage(item.language).startsWith('en'));
        return { items: english.slice(0, 6), fallback: false, message: '' };
    };

    const loadFeed = async () => {
        if (!listRoot) return;
        try {
            const response = await fetch('https://skoomaDen.me/rss.xml', { cache: 'no-store', mode: 'cors' });
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const text = await response.text();
            const parser = new DOMParser();
            const xml = parser.parseFromString(text, 'application/xml');
            const items = extractItemsFromXml(xml).sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
            const { items: displayItems, fallback, message } = pickItemsForLanguage(items);
            renderPosts(displayItems, { fallback, message });
        } catch (error) {
            console.error('[Blog] feed error:', error);
            if (statusNode) {
                statusNode.hidden = false;
                statusNode.textContent = translations[selectedLang]['error'] || 'Could not load the blog feed right now.';
            }
        }
    };

    // Language button click handlers
    languageButtons.forEach((button) => {
        button.addEventListener('click', () => {
            if (button.dataset.blogLang) {
                selectedLang = button.dataset.blogLang;
                sessionStorage.setItem('blogLanguage', selectedLang);
                applyTranslations(selectedLang);
                updateLanguageButtons();
                loadFeed(); // Reload with new language
            }
        });
    });

    loadFeed();

    window.addEventListener('resize', () => {
        if (!lastRenderedItems.length) return;
        clearTimeout(resizeDebounceId);
        resizeDebounceId = setTimeout(() => {
            renderPosts(lastRenderedItems, lastRenderOptions);
        }, 120);
    });

    externalButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
            const targetUrl = selectedLang === 'fr' ? 'https://skoomaDen.me/fr' : 'https://skoomaDen.me';
            window.open(targetUrl, '_blank', 'noopener');
        });
    });
})();
</script>

</body>
</html>
